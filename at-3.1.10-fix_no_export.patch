--- at-3.1.10/at.c.fix	2006-09-12 13:21:16.000000000 +0200
+++ at-3.1.10/at.c	2006-09-12 13:20:08.000000000 +0200
@@ -396,8 +396,9 @@
 	    unsigned int i;
 	    for (i = 0; i < sizeof(no_export) / sizeof(no_export[0]); i++) {
 		export = export
-		    && (strncmp(*atenv, no_export[i],
-				(size_t) (eqp - *atenv)) != 0);
+	    	    && (  (((size_t) (eqp - *atenv)) != strlen(no_export[i]))
+			||(strncmp(*atenv, no_export[i],(size_t) (eqp - *atenv)) != 0)
+                );
 	    }
 	    eqp++;
 	}
--- at-3.1.10/at.1.in.fix	2006-09-12 13:21:16.000000000 +0200
+++ at-3.1.10/at.1.in	2006-09-12 13:10:28.000000000 +0200
@@ -42,8 +42,7 @@
 and
 .B batch
 read commands from standard input or a specified file which are to
-be executed at a later time, using
-.BR /bin/sh .
+be executed at a later time.
 .TP 8
 .BR at
 executes commands at a specified time.
@@ -244,8 +243,56 @@
 option argument, which must have the same format as specified for the
 .BR touch(1)
 utility's
-.B -t
+.B \-t
 time option argument ([[CC]YY]MMDDhhmm).
+.SH ENVIRONMENT
+.P
+.TP 8
+.B SHELL
+The value of the SHELL environment variable at the time of
+.B at
+invocation will determine which shell is used to execute the
+.B at
+job commands. If SHELL is unset when
+.B at
+is invoked, the user's login shell will be used; otherwise,
+if SHELL is set when
+.B at
+is invoked, it must contain the path of a shell interpreter
+executable that will be used to run the commands at the specified time.
+.P
+.B at
+will record the values of
+environment variables present at time of
+.B at
+invocation. When the commands are run at the  specified time,
+.B at
+will restore these variables to their recorded values .
+These variables are excluded from this processing and are never
+set by
+.B at
+when the commands are run :
+.br
+.BI TERM,
+.BI DISPLAY,
+.BI SHELLOPTS,
+.BI _,
+.BI PPID,
+.BI BASH_VERSINFO,
+.BI EUID,
+.BI UID,
+.BI GROUPS.
+.br
+If the user submitting the
+.B at
+job is not the super-user, variables that alter the behaviour of the
+loader
+.BR ld.so(8),
+such as
+.B LD_LIBRARY_PATH
+, cannot be recorded and restored by
+.B at .
+.P
 .SH FILES
 .I @ATJBD@
 .br
